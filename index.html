<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>

<div class="debugBox">
    <div>
        Repo: <input id='repoURL' type=text style="width:500px"
        value='michaeldowd2/Wikiart_tSNE'>
        <button onclick="GetRepoFiles()">Load</button>
    </div>
    <hr>
    <div id="debugResultBox"> </div>
</div>

<script>
    function GetRepoFiles(repo) {
        repo = document.getElementById('repoURL').value
        masterURL = 'https://api.github.com/repos/' + repo + '/branches/master'
        var lastCommitReq = new XMLHttpRequest();
        lastCommitReq.open("GET", masterURL, true);
        lastCommitReq.responseType = "json";
        lastCommitReq.onload = function(oEvent) {
            var obj = lastCommitReq.response;
            console.log('received json for last commit')
            treeURL=obj["commit"]["commit"]["tree"]["url"]
            console.log(treeURL)

            var fileTreeReq = new XMLHttpRequest();
            fileTreeReq.open("GET", treeURL, true);
            fileTreeReq.responseType = "json";
            fileTreeReq.onload = function(oEvent) {
                var obj = fileTreeReq.response;
                console.log('received json for tree')
                treeObject = obj["tree"]
                console.log(treeObject)
                itemList = BuildItemList(treeObject,'',repo)
                console.log('item list')
                console.log(itemList)
            };
            console.log('Sending Request for file list to: ' + masterURL)
            fileTreeReq.send();
        };
    console.log('Sending Request for last commit to: ' + masterURL)
    lastCommitReq.send();
    };

    function GetFolderContents(target) {
       var req = new XMLHttpRequest();
       req.open("GET", target, true);
       req.responseType = "json";
       req.onload = function(oEvent) {
           console.log('received tree json')
           var obj = req.response;
           treeObject = obj["tree"]
           console.log(treeObject)
       };
       console.log('Sending Request to: ' + target)
       req.send();
    };

    function ShowRateLimit() {
        var req = new XMLHttpRequest();
        req.open("GET", 'https://api.github.com/rate_limit', true);
        req.responseType = "json";
        req.onload = function(oEvent) {
            console.log('Rate Limit')
            var obj = req.response;
            console.log(obj)
        };
        console.log('Sending Rate Limit Request')
        req.send();
    }

    function BuildItemList(treeObject, Directory, Repo) {
        newArray = []
        document.getElementById('debugResultBox').innerHTML += '<h3>Repo Wrapper: '+ Repo +'</h3><ul>'
        treeObject.forEach(function(item,index) {
            //is it an image
            if (item["type"]=='blob' && (item["path"].toUpperCase().includes('.JPG') || item["path"].toUpperCase().includes('.PNG'))) {
                title = item["path"]
                repoPath = Directory + '/' + item["path"]
                URL = 'https://raw.githubusercontent.com/' + Repo + '/master/'+repoPath
                item = {Type: "Image", Title:title, Subtitle:'', Directory: Directory, URL: URL }
                newArray.push(item)

                document.getElementById('debugResultBox').innerHTML += '<li>'+item["Type"]+': ' +item["Title"]+ ', URL: '+item["URL"]+'</li>'
            }
            if (item["type"]=='tree'){
                title = item["path"]
                repoPath = Directory + '/' + item["path"]
                URL = item['url']
                item = {Type: "Folder", Title:title, Subtitle:'', Directory: Directory, URL: URL }
                newArray.push(item)

                document.getElementById('debugResultBox').innerHTML += '<li>'+item["Type"]+': ' +item["Title"]+', API URL: '+item["URL"]+'</li>'
            }
        })
        document.getElementById('debugResultBox').innerHTML += '</ul>'
        return newArray
    }

    window.onload = function() {
        GetRepoFiles()
        GetFolderContents('https://api.github.com/repos/michaeldowd2/Wikiart_tSNE/git/trees/090eed72ef156494eede0d00ca3f62da010eb330')
        ShowRateLimit()
    }

</script>

