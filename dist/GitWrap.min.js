var SiteTree={},JustRepo="",TopPath="",CurrentPath="";function getRepoFromBox(){userRepo=document.getElementById("repoBox").value,newURL=window.location.href+"?Repo="+userRepo,window.location.href=newURL}function getJsonFromUrl(url){url||(url=location.href);var question=url.indexOf("?"),hash=url.indexOf("#");if(-1==hash&&-1==question)return{};-1==hash&&(hash=url.length);var query=-1==question||hash==question+1?url.substring(hash):url.substring(question+1,hash),result={};return query.split("&").forEach((function(part){if(part){var eq=(part=part.split("+").join(" ")).indexOf("="),key=eq>-1?part.substr(0,eq):part,val=eq>-1?decodeURIComponent(part.substr(eq+1)):"",from=key.indexOf("[");if(-1==from)result[decodeURIComponent(key)]=val;else{var to=key.indexOf("]",from),index=decodeURIComponent(key.substring(from+1,to));key=decodeURIComponent(key.substring(0,from)),result[key]||(result[key]=[]),index?result[key][index]=val:result[key].push(val)}}})),jQuery.isEmptyObject(result.Repo)||(REPO=result.Repo),CurrentPath=jQuery.isEmptyObject(result.Path)?"":result.Path,console.log("Repo from URL: "+REPO),console.log("Current Path from URL: "+CurrentPath),result.Repo}function BuildSiteTree(TreeObject){TreeObject.forEach((function(item,index){(""===TopPath||item.path.indexOf(0===TopPath))&&("blob"==item.type&&(item.path.toUpperCase().includes(".JPG")||item.path.toUpperCase().includes(".PNG"))&&(title=item.path.substring(item.path.lastIndexOf("/")),URL="https://raw.githubusercontent.com/"+JustRepo+"/master/"+item.path,newItem={Type:"Image",Title:title,Subtitle:"",Path:item.path,URL:URL},SiteTree[item.path]=newItem),"tree"==item.type&&(title=item.path.substring(item.path.lastIndexOf("/")),URL=item.url,newItem={Type:"Folder",Title:title,Subtitle:"",Path:item.path+"/",URL:URL},SiteTree[item.path]=newItem))}))}function AddFolder(Container,Item){Container.innerHTML+='<div class="itemBox" onclick=\'LoadItemsFromPathLink("'+Item.Path+"\")'>"+Item.Type+": "+Item.Title+"</div>"}function AddImage(Container,Item){Container.innerHTML+='<img src="'+Item.URL+'" alt="'+Item.Title+'">'}function LoadItemsFromPathLink(Path){CurrentPath=Path,LoadItemsToPage()}function LoadItemsToPage(Push=!0,Replace=!1){""!==CurrentPath&&(newURL=window.location.href+"&Path="+CurrentPath,Push?history.pushState("","",newURL):Replace&&history.replaceState("","",newURL)),console.log("Loading Items to Page for Path: "+CurrentPath),container=document.getElementById("content"),container.innerHTML="",Object.keys(SiteTree).forEach((function(key){(""===CurrentPath&&key.indexOf("/")<0||0===key.indexOf(CurrentPath)&&key.substring(CurrentPath.length).indexOf("/")<0)&&(item=SiteTree[key],"Image"===item.Type&&item.Title.includes("Summary")?AddImage(container,item):"Folder"==item.Type&&AddFolder(container,item))}))}function GetRepoFiles(Repo){if(JustRepo=Repo,repoArray=Repo.split("/"),repoArray.length-1>2)for(JustRepo=repoArray[0]+"/"+repoArray[1],i=2;i<repoArray.length;i++)TopPath+=repoArray[i]+"<br>";console.log("JustRepo: "+JustRepo),console.log("TopPath: "+TopPath),masterURL="https://api.github.com/repos/"+JustRepo+"/branches/master";var lastCommitReq=new XMLHttpRequest;lastCommitReq.open("GET",masterURL,!0),lastCommitReq.responseType="json",lastCommitReq.onload=function(oEvent){var obj=lastCommitReq.response;treeURL=obj.commit.commit.tree.url+"?recursive=1";var fileTreeReq=new XMLHttpRequest;fileTreeReq.open("GET",treeURL,!0),fileTreeReq.responseType="json",fileTreeReq.onload=function(oEvent){var obj=fileTreeReq.response;console.log("received json for tree"),treeObject=obj.tree,BuildSiteTree(treeObject),console.log("SiteTree"),console.log(SiteTree),LoadItemsToPage(Push=!1,Replace=!0)},console.log("Sending Request for file list to: "+masterURL),fileTreeReq.send()},console.log("Sending Request for last commit to: "+masterURL),lastCommitReq.send()}function GetFolderContents(Repo,Directory,target){var req=new XMLHttpRequest;req.open("GET",target,!0),req.responseType="json",req.onload=function(oEvent){console.log("received tree json");var obj=req.response;treeObject=obj.tree,itemList=BuildItemList(treeObject,Directory,Repo),LoadItemsToPage(Repo,itemList)},console.log("Sending Request to: "+target),req.send()}function ShowRateLimit(){var req=new XMLHttpRequest;req.open("GET","https://api.github.com/rate_limit",!0),req.responseType="json",req.onload=function(oEvent){console.log("Rate Limit");var obj=req.response;console.log(obj)},console.log("Sending Rate Limit Request"),req.send()}function LoadPageTemplate(){document.getElementsByClassName("navBar").innerHTML="<h1>"+REPO+"</h1>"}function LoadFromParams(){getJsonFromUrl(),""!==REPO?(console.log("Repo: "+REPO),document.getElementById("loadBox").style.display="none",LoadPageTemplate(),GetRepoFiles(REPO)):document.getElementById("content").style.display="none"}window.onpopstate=function(event){console.log("popping, calling loadfromparams for"),console.log(window.location.href),getJsonFromUrl(),LoadItemsToPage(Push=!1,Replace=!1)};